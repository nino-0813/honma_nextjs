# 管理画面 Basic認証 実装ガイド

## 概要

管理画面（`/admin`）へのアクセス時に Basic認証を要求する機能を実装しました。

## 実装方法

### 1. ファイル構成

- `middleware.ts`: Vercel Edge Middleware（Basic認証を実装）
- `vercel.json`: ルーティング設定（`/admin` パスは `middleware.ts` で処理）

### 2. 動作フロー

1. ユーザーが `/admin` にアクセス
2. `middleware.ts` がリクエストをインターセプト
3. Edge Middleware で Basic認証をチェック
4. 認証成功: リクエストをそのまま通過（クライアントサイドで `/admin` にルーティング）
5. 認証失敗: 401 Unauthorized を返し、ブラウザが Basic認証ダイアログを表示

### 3. 環境変数の設定

Vercel ダッシュボードで以下の環境変数を設定してください：

```
ADMIN_BASIC_AUTH_USER=your_admin_username
ADMIN_BASIC_AUTH_PASS=your_admin_password
```

**重要:**
- `VITE_` プレフィックスを付けないでください（サーバーサイドでのみ使用）
- 本番環境（Production）でのみ設定することを推奨
- 開発環境では設定しないと認証がスキップされます（ローカル開発が容易）

### 4. 設定手順（重要）

#### Step 1: Vercel ダッシュボードにアクセス
1. [Vercel ダッシュボード](https://vercel.com/dashboard) にログイン
2. プロジェクト `honma-ec` を選択

#### Step 2: 環境変数を設定
1. プロジェクトページで **Settings** タブをクリック
2. 左サイドバーから **Environment Variables** を選択
3. 以下の環境変数を追加：

   **環境変数 1:**
   - **Key**: `ADMIN_BASIC_AUTH_USER`
   - **Value**: 管理画面のユーザー名（例: `admin`）
   - **Environment**: `Production` を選択（必要に応じて `Preview` も選択可）

   **環境変数 2:**
   - **Key**: `ADMIN_BASIC_AUTH_PASS`
   - **Value**: 管理画面のパスワード（例: `your_secure_password_123`）
   - **Environment**: `Production` を選択（必要に応じて `Preview` も選択可）

4. 各環境変数を追加したら **Save** をクリック

#### Step 3: 再デプロイ（必須）
環境変数を追加・変更した後は、**必ず再デプロイが必要**です：

1. プロジェクトページの **Deployments** タブを開く
2. 最新のデプロイメントの右側にある **「...」メニュー** をクリック
3. **Redeploy** を選択
4. 確認ダイアログで **Redeploy** をクリック

または、GitHubにプッシュすることで自動的に再デプロイされます。

#### 注意事項
- **`VITE_` プレフィックスは付けないでください**（サーバーサイドでのみ使用）
- 環境変数は **Production 環境のみ** に設定することを推奨（開発が容易）
- パスワードは **強力なもの** を設定してください（英数字・記号を含む8文字以上推奨）

### 5. 動作確認

1. 環境変数を設定して再デプロイ
2. 本番環境の `/admin` にアクセス
3. Basic認証ダイアログが表示されることを確認
4. 設定したユーザー名・パスワードでログイン
5. 管理画面が表示されることを確認

### 6. 注意事項

- **既存の Supabase 認証は変更されていません**
  - Basic認証は管理画面へのアクセス時にのみ要求されます
  - 管理画面内の Supabase 認証（ログイン画面）は従来通り動作します

- **フロントコードへの影響**
  - フロントコードは一切変更されていません
  - クライアントサイドのルーティング（`/admin`）は従来通り動作します

- **開発環境**
  - 環境変数が設定されていない場合、認証はスキップされます
  - ローカル開発時は `vercel dev` を使用するか、環境変数を設定してください

### 7. トラブルシューティング

#### Basic認証ダイアログが表示されない

- 環境変数が正しく設定されているか確認
- 再デプロイを実行しているか確認
- Vercel ダッシュボードの Functions タブでエラーログを確認

#### 認証後も管理画面にアクセスできない

- ブラウザのキャッシュをクリア
- シークレットモードで試す
- Vercel ダッシュボードの Functions タブでエラーログを確認

#### 開発環境で認証が要求される

- 環境変数を Preview/Development 環境に設定していないか確認
- または、ローカル開発時は環境変数を設定しない

## セキュリティに関する注意

- Basic認証は平文で送信されるため、HTTPS を使用することが重要です
- Vercel の本番環境は自動的に HTTPS が有効になっています
- 強力なパスワードを設定してください
- 定期的にパスワードを変更することを推奨します

